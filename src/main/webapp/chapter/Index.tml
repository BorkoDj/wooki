<html t:type="booklayout"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter" t:title="prop:book?.title" t:bookId="book?.id">

	<t:if test="viewingRevision">
		<ul id="issues-links" class="nav right-col">
			<li>
				<a t:type="pagelink" t:page="chapter/issues" t:context="allIssuesCtx">All issues</a>
			</li>
			<li id="nav-right">
				<a t:type="pagelink" t:page="chapter/issues" t:context="chapIssuesCtx">Chapter issues</a>
			</li>
		</ul>
		<div class="info">
			<p>You are currently viewing the revision "${revision}" of this chapter.</p>
		</div>
		<p:else>
			<t:security.ifAuthorOfBook t:bookId="bookId">
				<div class="book-admin">
					<ul>
						<li><a t:type="pagelink" t:page="chapter/edit" t:context="prop:editCtx">Edit</a></li>
						<li><a t:type="eventlink" t:event="delete" t:context="prop:editCtx" t:mixins="confirm">Delete</a></li>
					</ul>
				</div>
			</t:security.ifAuthorOfBook>	
		
			<ul id="exports" class="nav right-col">
				<t:ifNotNull test="previous">
					<li id="nav-left">
						<a t:type="pagelink" t:page="chapter/index" t:context="previousCtx" title="${previousTitle}">&lt; Previous</a>
					</li>
				</t:ifNotNull>
				<t:ifNotNull test="next">
					<li id="nav-right">
						<a t:type="pagelink" t:page="chapter/index" t:context="nextCtx" title="${nextTitle}">Next &gt;</a>
					</li>
				</t:ifNotNull>
			</ul>
		</p:else>
	</t:if>

	<h1><a href="#" t:type="pagelink" t:page="book/index" t:context="book?.id">${book?.title}</a></h1>
	
	<h2 class="entry-title"><a href="#" rel="bookmark" title="Permalink to this PAGE">${chapter?.title}</a></h2>
	
	<t:ifNotNull t:test="content">
		<t:outputRaw value="content" />
		<p:else>
			This chapter is still empty. Please come back later to see if the author have written something.
		</p:else>
	</t:ifNotNull>

	<!-- Attach bubble to content -->
	<t:commentBubbles t:publicationId="publicationId" t:bookId="bookId" />

</html>
