<html t:type="booklayout"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter" t:title="prop:book?.title" t:bookId="book?.id">

<header>

	
	<p id="authors">
		<t:loop source="authors" value="currentUser" index="loopIdx">
			${currentUser.fullname} <a t:type="pagelink" t:page="index" t:context="currentUser.username">${currentUser.username}</a>
			<t:if test="notLastAuthor">, </t:if>
		</t:loop>		
	</p>
	
	<p id="published">
		<t:output value="prop:book?.creationDate" t:format="prop:format" /> Edition
	</p>
	
	
	<nav id="book-actions">
		<ul>
			<t:security.ifAuthorOfBook t:bookId="bookId">
				<t:if t:test="abstractHasWorkingCopy">
					<li><a t:type="pagelink" t:page="book" t:context="prop:abstractWorkingCopyCtx">Working Copy</a></li>
				</t:if>
				<li><a t:type="pagelink" t:page="chapter/edit" t:context="prop:editCtx">Edit Abstract</a></li>
				<li><a t:type="pagelink" t:page="book/settings" t:context="prop:bookId">Settings</a></li>
			</t:security.ifAuthorOfBook>
		
			<li><a t:type="eventlink" t:event="print" t:name="prop:book.slugTitle">Print</a></li>

		</ul>
	</nav>
	<div class="clearer" />

	
	<section class="abstract">
		<t:outputRaw value="abstractContent" />
	</section>

</header> 


<div class="entry-content">
	<h2 class="entry-title"><a href="#" rel="bookmark" title="Permalink to this PAGE">Table of contents</a></h2>
	
	<ol id="chapters-list">
		<t:loop t:source="chaptersInfo" t:value="currentChapter">
			<li>
				<h3>
					<t:if t:test="published">
						<t:pagelink t:page="chapter/index" t:context="chapterCtx">${currentChapter.title}</t:pagelink>
						<p:else><span class="inactive">${currentChapter.title} <em>(not published) </em></span>
						</p:else>
					</t:if>
					
					<t:if t:test="showWorkingCopyLink">
						<t:security.ifAuthorOfBook t:bookId="bookId">
							<t:pagelink t:page="chapter/index" t:context="chapterWorkingCopyCtx"><em>Working copy</em></t:pagelink>
						</t:security.ifAuthorOfBook>
					</t:if>
		
				</h3>
				<p><t:lastModifiedFormatter t:time="currentChapter.lastModified?.time" /></p>
			</li>
		</t:loop>
		
		
		<t:security.ifAuthorOfBook t:bookId="bookId">
			<li>
				<t:zone id="addChapterZone" t:update="none">
					<t:delegate t:to="addChapterToggle" t:id="addChapterDelegate" />
				</t:zone>
			</li>
			
			<t:block id="addChapterLink">
				<h3>
					<t:actionlink class="active" t:id="showAddChapterField" t:zone="addChapterZone">Add a chapter</t:actionlink>
				</h3>
			</t:block>
			
			<t:block id="addChapterForm">
				<t:form t:id="addChapterForm" class="big-form">
					<h3>
						<t:textfield t:value="chapterName" class="long-field" t:validate="required" /><t:linksubmit class="radied-box active-button inline-form-button">Add</t:linksubmit>
					</h3>
					<p>
						 <t:linkSubmit class="active-button radied-box inline-form-button">Cancel</t:linkSubmit>
					</p>
				</t:form>
			</t:block>
				
		</t:security.ifAuthorOfBook>
	</ol>
	
	<div class="clearer"  />
</div>

<t:commentBubbles t:publicationId="publicationId" t:bookId="book?.id" />

</html>
